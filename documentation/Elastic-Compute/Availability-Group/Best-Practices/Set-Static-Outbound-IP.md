# 设置固定出口IP

如果您高可用组内的云主机，同时存在这三个需求：

* 从负载均衡接受请求
* 高可用组内云主机需要主动访问公网
* 访问公网时希望用固定的公网IP

![](../../../../image/ag/settingoutboundIP.png)

## 操作步骤


**第一步：创建私有网络及两个子网：子网1及子网2，其中一个子网为高可用组所在子网，一个为NAT实例所在子网。**

1. 访问[私有网络控制台](https://cns-console.jdcloud.com/vpc/list)，即进入私有网络列表页面。或访问[京东云控制台](https://console.jdcloud.com)点击左侧导航栏【网络】-【私有网络】进入私有网络列表页。
2. 选择地域。
3. 点击【创建】按钮。
4. 弹出创建私有网络弹窗，设置私有网络名称及描述。
	
	这一步名称设为：“Web服务”。
5. 设置私有网络的CIDR：设置私有网络的边界，CIDR只能是内网网段，可选范围为10.0.0.0(掩码为16~28)、172.16.0.0~172.31.0.0(掩码为16~28)、192.168.0.0(掩码为16~28)。也可不预设CIDR，此时vpc的边界将随其中子网的网段自动伸缩，建议对网络理解深刻的用户选择无预设CIDR的私有网络。

	这一步CIDR设为192.168.0.0/16的私有网络，名称为。

6. 点击【确定】后即可进查看创建的私有网络。
7. 访问[子网控制台](https://cns-console.jdcloud.com/subnet/list)，即进入子网列表页面。或访问[京东云控制台](https://console.jdcloud.com)点击左侧导航栏【网络】-【私有网络】-【子网】进入子网列表页。
8. 选择刚才创建私有网络的地域，点击【创建】，弹出创建子网弹窗。
9. 选择所属私有网络“Web服务”；子网的CIDR只能是内网网段，可选范围在“Web服务”CIDR范围内，这里为子网1分配了192.168.1.0/24，为子网2分配了192.168.2.0/24。
10. 设置子网名称及描述。
11. 选择子网关联的路由表，每个子网能够关联一张路由表，且必须关联一张路由表，请注意给有公网访问需求的子网1配置单独的一个路由表，如“高可用组路由表”。
12. 点击【确定】触发创建子网。

**第二步：在子网2内创建NAT实例，并为该实例分配弹性公网IP，该IP即为高可用组内云主机访问公网的固定IP地址。**

创建NAT实例详细步骤可以参照[创建Linux实例](../../Virtual-Machines/Getting-Start-Linux/Create-Instance.md)，只需选择官方镜像中CentOS 7.2 64位 NAT Gateway即可。

**第三步：配置私有网络路由表，将子网1的公网流量导向NAT实例。**

1. 访问[路由表控制台](https://cns-console.jdcloud.com/routeTable/list)，即进入路由表列表页面。或访问[京东云控制台](https://console.jdcloud.com)点击左侧导航栏【网络】-【私有网络】-【路由表】进入路由表列表页。
2. 找到“高可用组路由表”，点击名称进入详情页；
3. 点击【路由策略】标签，查看路由策略Tab信息，点击【编辑】。
4. 添加路由策略，目的端为公网地址或0.0.0.0/0，下一跳类型为云主机，下一跳选择之前通过NAT Gateway镜像创建的实例。
5. 点击【保存】。

**第四步：基于子网1创建高可用组，并向高可用组内新增实例。**

您现在需要为您业务创建高可用组。详细步骤可查阅[高可用组快速入门](../Getting-Start.md)。

	请注意的是，高可用组所在私有网络需要与NAT实例所在私有网络相同，但所在子网需要不同。
	
至此高可用组内云主机均可用过NAT实例所配置的弹性公网IP访问公网。


## 相关参考

[创建Linux实例](../../Virtual-Machines/Getting-Start-Linux/Create-Instance.md)
