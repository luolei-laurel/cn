# 编排上线


通过编写json的方式，支持跨应用部署发布操作，并提供穿并行、失败阈值等设置。

点击菜单栏中的“持续交付”，进入“编排上线”。

1.新建视图

填写视图名称、超时时间等配置

2.编写视图内容

- 层之间是串行的
- 每层内的 job 可以并行，如层的并发度设置为6，则最多有6个 job 同时执行
- job 内的并发度按 job 支持的方式设置，与页面操作行为一致。如包部署 job，其 concurrency 字段取值及含义为：0-串行,30-30%,70-70%,100-并行；而镜像部署 job，其concurrency 字段取值：0-并行,1-串行…
- 层内执行失败的 job 数达到配置的 max_fail（失败阈值）时，标记该层以及整个视图失败 可参看以下示例,

```
[
    // 层级1
    {
        "concurrency": 2, // 分组1内并发度（注意：0表示全并发,1表示串行,n 表示最多同时有 n 个 job 同时执行）
        "timeout": 1200,  // 分组1超时时间（s）
        "pause": 1,       // 本层执行完成后,视图会进入“暂停”状态,在执行记录中点击“继续执行”后方可执行后续层级
        "max_fail": 3,    // 本层失败 job 数达到3时才标记本层（以及整个视图）为失败,这里如果给0则忽略所有失败 job
        // 分组1内的部署 job,每个 job 对应一个 APP 的部署
        "jobs": [
            // job1
            {
                "app_name": "yangxiaojia-test-app1",  // job1 APP 名
                "concurrency": "0",                   // job1 实例并发度（包部署：0-串行,30-30%,70-70%,100-并行 || 镜像部署：0-并行,1-串行,2-同时最多2个实例并行…）
                "instance_timeout": 300,              // job1 执行超时时间（s）
                // job1 部署目标
                "target": [
                    "group-hb",                      // 目标分组（如果是包部署也可以是实例,如0.group-hb）
                    "group-sh"
                ],
                "type": "1",                          // job1 上线类型：1-包部署,2-镜像部署,4-弹性部署,5-弹性扩容
                "version": "4f40681d-20170622095458"  // job1 上线包版本
            }
            // 其他job
            ...
        ]
    }
    // 其他层级
    ...
]
```

3.保存视图后，可支持编辑、执行、查看执行历史、删除操作
